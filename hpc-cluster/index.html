

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Julia on HPC cluster &mdash; Julia for High-Performance Scientific Computing</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_lesson.css?v=e9df6548" />
      <link rel="stylesheet" type="text/css" href="../_static/term_role_formatting.css?v=4194e21c" />
      <link rel="stylesheet" type="text/css" href="../_static/overrides.css" />
      <link rel="stylesheet" type="text/css" href="../_static/overrides.css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=187304be"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="../_static/minipres.js?v=a0d29692"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script data-domain="enccs.github.io/julia-for-hpc" defer="defer" src="https://plausible.io/js/script.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Message passing" href="../MPI/" />
    <link rel="prev" title="Parallel execution with Dagger" href="../dagger/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            Julia for High-Performance Scientific Computing
              <img src="../_static/ENCCS.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Prerequisites</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/">Setup</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../motivation-hpc/">Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performant-code/">Writing performant Julia code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../multithreading/">Multithreading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed/">Distributed computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dagger/">Parallel execution with Dagger</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Julia on HPC cluster</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#julia-on-hpc-systems">Julia on HPC systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="#terminology-of-an-hpc-cluster">Terminology of an HPC cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-module-environments">Using module environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-packages">Installing packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-interactive-jobs">Running interactive jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-batch-jobs">Running batch jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-julia-application-in-a-job">Running Julia application in a job</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../MPI/">Message passing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GPU/">GPU programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfacing/">Interfacing to C, Fortran, and Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conclusions/">Summary and outlook</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Optional episodes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../exercises/">Advanced exercises</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor’s guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Julia for High-Performance Scientific Computing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Julia on HPC cluster</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/enccs/Julia-for-HPC/blob/master/content/hpc-cluster.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="julia-on-hpc-cluster">
<h1>Julia on HPC cluster<a class="headerlink" href="#julia-on-hpc-cluster" title="Link to this heading"></a></h1>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>How do we run Julia in an HPC cluster?</p></li>
<li><p>How can we do parallel computing with Julia on an HPC cluster?</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>30 min teaching</p></li>
<li><p>30 min exercises</p></li>
</ul>
</div>
<section id="julia-on-hpc-systems">
<h2>Julia on HPC systems<a class="headerlink" href="#julia-on-hpc-systems" title="Link to this heading"></a></h2>
<p>Despite rapid growth in the HPC domain in recent years, Julia is still not considered as mainstream as C/C++ and Fortran in the HPC world, and even Python is more commonly used (and generally available) than Julia.
Fortunately, even if Julia is not already available as an environment module on your favorite cluster, it is easy to install Julia from scratch.
Moreover, there is little reason to expect the performance of official Julia binaries to be any worse than if a system administrator built Julia from scratch with architecture-specific optimization.
<a class="reference external" href="https://juliahpc.github.io/">Julia on HPC clusters</a> gives an overview of the availability and documentation of Julia on a range of HPC systems around the world, including EuroHPC systems.</p>
</section>
<section id="terminology-of-an-hpc-cluster">
<h2>Terminology of an HPC cluster<a class="headerlink" href="#terminology-of-an-hpc-cluster" title="Link to this heading"></a></h2>
<p>HPC cluster consists of networked computers called <strong>nodes</strong>.
The nodes are separated into user-facing <strong>login nodes</strong> and nodes that are intended for heavy computing called <strong>compute nodes</strong>
The nodes are colocated and connected using a <strong>high-speed network</strong> minimize communication latency and maximize performance at scale.
A <strong>parallel file system</strong> provides a system-wide mass storage capacity.</p>
<p>HPC clusters use the <strong>Linux operating system</strong>.
Many problems that users have with using a cluster stem from a lack of Linux knowledge.</p>
<p>Clusters also use <strong>module environments</strong> to manage software environments by setting environment variables and loading other modules as dependencies.
We demonstrate the popular <strong>Lmod</strong> software and how to use Julia module environments with Lmod.</p>
<p>Finally, HPC clusters use a <strong>workload manager</strong> to manage resources and run jobs on compute nodes.
We demonstrate the popular <strong>Slurm</strong> workload manager and how to run Julia programs that perform various forms of parallel computing with Slurm.
We refer to a single workload run through a workload manager as a <strong>job</strong>.</p>
</section>
<section id="using-module-environments">
<h2>Using module environments<a class="headerlink" href="#using-module-environments" title="Link to this heading"></a></h2>
<p>We can load a Julia installation as a module environment if one is available.
The module environment modifies the path to make the Julia command line client available and may set environment variables for Julia thread count.</p>
<p>Available module environments are controlled by the module path (<code class="code docutils literal notranslate"><span class="pre">MODULEPATH</span></code>) environment variable.
Sometimes, it is necessary to add custom directories to the module path as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>module<span class="w"> </span>use<span class="w"> </span>&lt;path&gt;
</pre></div>
</div>
<p>We can check the availability of a Julia module environment as follows.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>module<span class="w"> </span>avail<span class="w"> </span>julia
</pre></div>
</div>
<p>If the Julia module is not available, we can install Julia manually to the cluster.
On the other hand, if a Julia module is available, we can take a look at what the Julia sets when it is loaded as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>module<span class="w"> </span>show<span class="w"> </span>julia
</pre></div>
</div>
<p>We can load the Julia module as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>module<span class="w"> </span>load<span class="w"> </span>julia
</pre></div>
</div>
<p>We can list the loaded module and check that Julia is available as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>module<span class="w"> </span>list
<span class="gp">$ </span>julia<span class="w"> </span>--version
</pre></div>
</div>
<p>In case everything works well, we should be ready to move forward.</p>
<div class="admonition-using-julia-on-the-lumi-cluster demo toggle-shown dropdown admonition" id="demo-0">
<p class="admonition-title">Using Julia on the LUMI cluster.</p>
<p>First, add CSC’s local module files to the module path.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>module<span class="w"> </span>use<span class="w"> </span>/appl/local/csc/modulefiles
</pre></div>
</div>
<p>The, load the Julia module.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>module<span class="w"> </span>load<span class="w"> </span>julia
</pre></div>
</div>
<p>We can load MPI preferences to use system the MPI with MPI.jl as runtime.
They are not required for installing MPI.jl.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>module<span class="w"> </span>load<span class="w"> </span>julia-mpi
</pre></div>
</div>
<p>We can load AMDGPU preferences to use the system AMDGPU and ROCm with AMDGPU.jl at runtime.
They are not required for installing AMDGPU.jl</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>module<span class="w"> </span>load<span class="w"> </span>julia-amdgpu
</pre></div>
</div>
</div>
</section>
<section id="installing-packages">
<h2>Installing packages<a class="headerlink" href="#installing-packages" title="Link to this heading"></a></h2>
<p>We can install Julia packages normally using the package manager on a login node in a cluster.
We also recommend to precompile Julia environments on the login node using them on the compute nodes.
Precompiling and installing Julia packages on a compute node may run into issues with limited temporary disk space and it consumes the resources allocated to the job.
Packages such as MPI.jl, CUDA.jl, AMDGPU.jl and other can be installed normally.
The cluster specific preferences are required only to use system installed MPI and GPU libraries at runtime.</p>
<div class="admonition-installing-julia-packages-on-the-lumi-cluster demo toggle-shown dropdown admonition" id="demo-1">
<p class="admonition-title">Installing Julia packages on the LUMI cluster.</p>
<p>Load the Julia module and start interactive Julia session with multiple threads to speed up package installation.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>module<span class="w"> </span>use<span class="w"> </span>/appl/local/csc/modulefiles
<span class="gp">$ </span>module<span class="w"> </span>load<span class="w"> </span>julia
<span class="gp">$ </span>julia<span class="w"> </span>--threads<span class="w"> </span><span class="m">8</span>
</pre></div>
</div>
<p>In the Julia session, load the package manager and install packages for MPI, GPU and parallel computing.
Finally, precompile the packages.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Pkg</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;MPI&quot;</span><span class="p">)</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;AMDGPU&quot;</span><span class="p">)</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;ClusterManagers&quot;</span><span class="p">)</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Dagger&quot;</span><span class="p">)</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">precompile</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="running-interactive-jobs">
<h2>Running interactive jobs<a class="headerlink" href="#running-interactive-jobs" title="Link to this heading"></a></h2>
<p>We can launch an interactive job on a compute node via Slurm.
Interactive jobs are useful for developing, testing, debugging, and exploring Slurm jobs.
We can run an interactive job as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>srun<span class="w"> </span><span class="o">[</span>options<span class="o">]</span><span class="w"> </span>--pty<span class="w"> </span>bash
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">srun</span></code> command launches the job with options that declare the resources we want to reserve, <code class="code docutils literal notranslate"><span class="pre">--pty</span></code> flag attached a pseudoterminal to the job and the argument to run <code class="code docutils literal notranslate"><span class="pre">bash</span></code>.</p>
<div class="admonition-running-interactive-cpu-job-on-lumi demo toggle-shown dropdown admonition" id="demo-2">
<p class="admonition-title">Running interactive CPU job on LUMI.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--account<span class="o">=</span>project_465001310<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--partition<span class="o">=</span>debug<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--nodes<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--ntasks-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cpus-per-task<span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--mem-per-cpu<span class="o">=</span><span class="m">1000</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--time<span class="o">=</span><span class="s2">&quot;00:15:00&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--pty<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>bash
</pre></div>
</div>
</div>
<div class="admonition-running-interactive-gpu-job-on-lumi demo toggle-shown dropdown admonition" id="demo-3">
<p class="admonition-title">Running interactive GPU job on LUMI.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--account<span class="o">=</span>project_465001310<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--partition<span class="o">=</span>dev-g<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--nodes<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--ntasks-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cpus-per-task<span class="o">=</span><span class="m">16</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--gpus-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--mem-per-cpu<span class="o">=</span><span class="m">1750</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--time<span class="o">=</span><span class="s2">&quot;00:15:00&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--pty<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>bash
</pre></div>
</div>
</div>
<div class="admonition-checking-partitions-on-lumi demo toggle-shown dropdown admonition" id="demo-4">
<p class="admonition-title">Checking partitions on LUMI.</p>
<p>The above job submission use the debug partition for quick testing.
We should change the partition for real workloads that require more resources.
One way to inspect partitions, is to use the <cite>scontrol</cite> as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>scontrol<span class="w"> </span>show<span class="w"> </span>partition<span class="w"> </span><span class="p">|</span><span class="w"> </span>less<span class="w"> </span>-S
</pre></div>
</div>
</div>
</section>
<section id="running-batch-jobs">
<h2>Running batch jobs<a class="headerlink" href="#running-batch-jobs" title="Link to this heading"></a></h2>
<p>We can run batch jobs via Slurm.
We use batch jobs to run workloads from start to finish without interacting with them.
We can run a batch job as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sbatch<span class="w"> </span><span class="o">[</span>options<span class="o">]</span><span class="w"> </span>batch.sh
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">sbatch</span></code> command launches the batch job, with options that declare the resources we want to reserve, and the batch script <code class="code docutils literal notranslate"><span class="pre">batch.sh</span></code> contains the commands to run the job.</p>
<div class="admonition-running-cpu-batch-job-on-lumi demo toggle-shown dropdown admonition" id="demo-5">
<p class="admonition-title">Running CPU batch job on LUMI.</p>
<p>We can write <code class="docutils literal notranslate"><span class="pre">batch.sh</span></code> file as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello, world!&quot;</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sbatch<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--account<span class="o">=</span>project_465001310<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--partition<span class="o">=</span>debug<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--nodes<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--ntasks-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cpus-per-task<span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--mem-per-cpu<span class="o">=</span><span class="m">1000</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--time<span class="o">=</span><span class="s2">&quot;00:15:00&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>batch.sh
</pre></div>
</div>
<p>Alternatively, we can specify the options as comments in the batch <code class="docutils literal notranslate"><span class="pre">batch.sh</span></code> and run in without option using <cite>sbatch</cite>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --account=project_465001310</span>
<span class="c1">#SBATCH --partition=debug</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --ntasks-per-node=1</span>
<span class="c1">#SBATCH --cpus-per-task=2</span>
<span class="c1">#SBATCH --mem-per-cpu=1000</span>
<span class="c1">#SBATCH --time=&quot;00:15:00&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello, world!&quot;</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sbatch<span class="w"> </span>batch.sh
</pre></div>
</div>
</div>
<div class="admonition-running-gpu-batch-job-on-lumi demo toggle-shown dropdown admonition" id="demo-6">
<p class="admonition-title">Running GPU batch job on LUMI.</p>
<p>We can write <code class="docutils literal notranslate"><span class="pre">batch.sh</span></code> file as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello, world!&quot;</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sbatch<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--account<span class="o">=</span>project_465001310<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--partition<span class="o">=</span>dev-g<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--nodes<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--ntasks-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cpus-per-task<span class="o">=</span><span class="m">16</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--gpus-per-node<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--mem-per-cpu<span class="o">=</span><span class="m">1750</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--time<span class="o">=</span><span class="s2">&quot;00:15:00&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>batch.sh
</pre></div>
</div>
<p>Alternatively, we can specify the options as comments in the batch <code class="docutils literal notranslate"><span class="pre">batch.sh</span></code> and run in without option using <cite>sbatch</cite>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --account=project_465001310</span>
<span class="c1">#SBATCH --partition=dev-g</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --ntasks-per-node=1</span>
<span class="c1">#SBATCH --cpus-per-task=16</span>
<span class="c1">#SBATCH --gpus-per-node=1</span>
<span class="c1">#SBATCH --mem-per-cpu=1750</span>
<span class="c1">#SBATCH --time=&quot;00:15:00&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello, world!&quot;</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sbatch<span class="w"> </span>batch.sh
</pre></div>
</div>
</div>
</section>
<section id="running-julia-application-in-a-job">
<h2>Running Julia application in a job<a class="headerlink" href="#running-julia-application-in-a-job" title="Link to this heading"></a></h2>
<p>Let’s consider a standalone Julia application that contains the following files:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">Project.toml</span></code> for describing project metadata and dependencies.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">script.jl</span></code> for an entry point to run the desired Julia workload.
Optionally, it can implement a command line client if we want to parse arguments that are supplied to the script.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">batch.sh</span></code> for a batch script for setting up the Julia environment and running the Julia workload.</p></li>
</ul>
<div class="admonition-example-of-running-julia-application-on-lumi demo toggle-shown dropdown admonition" id="demo-7">
<p class="admonition-title">Example of running Julia application on LUMI.</p>
<p>We assume that our current working directory is the Julia application.
Let’s write our Julia script to file named <code class="docutils literal notranslate"><span class="pre">script.jl</span></code>.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Example</span>
<span class="n">hello</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Our application depends on the Example.jl package, hence the <code class="docutils literal notranslate"><span class="pre">Project.toml</span></code> looks as follows:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[deps]</span>
<span class="n">Example</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;7876af07-990d-54b4-ab0e-23690620f79a&quot;</span>
</pre></div>
</div>
<p>We should instantiate the project enviroment on the login node.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>module<span class="w"> </span>use<span class="w"> </span>/appl/local/csc/modulefiles
<span class="gp">$ </span>module<span class="w"> </span>load<span class="w"> </span>julia
<span class="gp">$ </span>julia<span class="w"> </span>--project<span class="o">=</span>.<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;using Pkg; Pkg.instantiate()&#39;</span>
</pre></div>
</div>
<p>Next we write the batch script to file named <code class="docutils literal notranslate"><span class="pre">batch.sh</span></code>.
It runs the Julia script using the Julia environment with predefined slurm parameters.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --account=project_465001310</span>
<span class="c1">#SBATCH --partition=debug</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --ntasks-per-node=1</span>
<span class="c1">#SBATCH --cpus-per-task=1</span>
<span class="c1">#SBATCH --mem-per-cpu=1000</span>
<span class="c1">#SBATCH --time=&quot;00:05:00&quot;</span>
module<span class="w"> </span>use<span class="w"> </span>/appl/local/csc/modulefiles
module<span class="w"> </span>load<span class="w"> </span>julia
julia<span class="w"> </span>--project<span class="o">=</span>.<span class="w"> </span>script.jl
</pre></div>
</div>
<p>Finally, we can run the batch script using Slurm.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sbatch<span class="w"> </span>batch.sh
</pre></div>
</div>
</div>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading"></a></h2>
<p>In these exercises you should create the three files <code class="docutils literal notranslate"><span class="pre">Project.toml</span></code>, <code class="docutils literal notranslate"><span class="pre">script.jl</span></code>, and <code class="docutils literal notranslate"><span class="pre">batch.sh</span></code> and run them via Slurm in the LUMI cluster.
If the course has a resource reservation, we can use the <code class="code docutils literal notranslate"><span class="pre">--reservation=&quot;&lt;name&gt;&quot;</span></code> option to use it.</p>
<div class="admonition-run-multithreaded-job-on-lumi-cluster exercise important admonition" id="exercise-0">
<p class="admonition-title">Run multithreaded job on LUMI cluster</p>
<p>Run the following files in a single node job with two CPU cores and one julia thread per core.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">Project.toml</span></code></span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="c1"># empty Project.toml</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">script.jl</span></code></span><a class="headerlink" href="#id2" title="Link to this code"></a></div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Base</span><span class="o">.</span><span class="n">Threads</span>
<span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">nthreads</span><span class="p">())</span>
<span class="nd">@threads</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">eachindex</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="w">    </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">threadid</span><span class="p">()</span>
<span class="k">end</span>
<span class="n">println</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">batch.sh</span></code></span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --account=project_465001310</span>
<span class="c1">#SBATCH --partition=small</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --ntasks-per-node=1</span>
<span class="c1">#SBATCH --cpus-per-task=2</span>
<span class="c1">#SBATCH --mem-per-cpu=1000</span>
<span class="c1">#SBATCH --time=&quot;00:15:00&quot;</span>

module<span class="w"> </span>use<span class="w"> </span>/appl/local/csc/modulefiles
module<span class="w"> </span>load<span class="w"> </span>julia
julia<span class="w"> </span>--project<span class="o">=</span>.<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;using Pkg; Pkg.instantiate()&#39;</span>
julia<span class="w"> </span>--project<span class="o">=</span>.<span class="w"> </span>script.jl
</pre></div>
</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sbatch<span class="w"> </span>batch.sh
</pre></div>
</div>
</div>
</div>
<div class="admonition-run-single-node-distributed-job-on-lumi-cluster exercise important admonition" id="exercise-1">
<p class="admonition-title">Run single node distributed job on LUMI cluster</p>
<p>Run the following files a single node job with three CPU cores and one julia process per core.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">Project.toml</span></code></span><a class="headerlink" href="#id4" title="Link to this code"></a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[deps]</span>
<span class="n">Distributed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;8ba89e20-285c-5b6f-9357-94700520ee1b&quot;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">script.jl</span></code></span><a class="headerlink" href="#id5" title="Link to this code"></a></div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Distributed</span>
<span class="n">addprocs</span><span class="p">(</span><span class="n">Sys</span><span class="o">.</span><span class="n">CPU_THREADS</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">exeflags</span><span class="o">=</span><span class="s">&quot;--project=.&quot;</span><span class="p">)</span>

<span class="nd">@everywhere</span><span class="w"> </span><span class="n">task</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myid</span><span class="p">()</span>
<span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nd">@spawnat</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="n">task</span><span class="p">()</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">workers</span><span class="p">()]</span>
<span class="n">outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fetch</span><span class="o">.</span><span class="p">(</span><span class="n">futures</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">batch.sh</span></code></span><a class="headerlink" href="#id6" title="Link to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --account=project_465001310</span>
<span class="c1">#SBATCH --partition=small</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --ntasks-per-node=1</span>
<span class="c1">#SBATCH --cpus-per-task=3</span>
<span class="c1">#SBATCH --mem-per-cpu=1000</span>
<span class="c1">#SBATCH --time=&quot;00:15:00&quot;</span>

module<span class="w"> </span>use<span class="w"> </span>/appl/local/csc/modulefiles
module<span class="w"> </span>load<span class="w"> </span>julia
julia<span class="w"> </span>--project<span class="o">=</span>.<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;using Pkg; Pkg.instantiate()&#39;</span>
julia<span class="w"> </span>--project<span class="o">=</span>.<span class="w"> </span>script.jl
</pre></div>
</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sbatch<span class="w"> </span>batch.sh
</pre></div>
</div>
</div>
</div>
<div class="admonition-run-multi-node-distributed-job-on-lumi-cluster exercise important admonition" id="exercise-2">
<p class="admonition-title">Run multi node distributed job on LUMI cluster</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Currently <code class="docutils literal notranslate"><span class="pre">SlurmManager</span></code> gives errors on LUMI it tries to establish workers on multiple nodes.
You may still test the code on single node.</p>
</div>
<p>Run the following files on two node job with 128 tasks per node and one CPU code per task.
Add Julia workers using <code class="docutils literal notranslate"><span class="pre">SlurmManager</span></code> from the ClusterManager.jl package.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">Project.toml</span></code></span><a class="headerlink" href="#id7" title="Link to this code"></a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[deps]</span>
<span class="n">ClusterManagers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;34f1f09b-3a8b-5176-ab39-66d58a4d544e&quot;</span>
<span class="n">Distributed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;8ba89e20-285c-5b6f-9357-94700520ee1b&quot;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">script.jl</span></code></span><a class="headerlink" href="#id8" title="Link to this code"></a></div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Distributed</span>
<span class="k">using</span><span class="w"> </span><span class="n">ClusterManagers</span>
<span class="n">proc_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse</span><span class="p">(</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="nb">ENV</span><span class="p">[</span><span class="s">&quot;SLURM_NTASKS&quot;</span><span class="p">])</span>
<span class="n">addprocs</span><span class="p">(</span><span class="n">SlurmManager</span><span class="p">(</span><span class="n">proc_num</span><span class="p">);</span><span class="w"> </span><span class="n">exeflags</span><span class="o">=</span><span class="s">&quot;--project=.&quot;</span><span class="p">)</span>

<span class="nd">@everywhere</span><span class="w"> </span><span class="n">task</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myid</span><span class="p">()</span>
<span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nd">@spawnat</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="n">task</span><span class="p">()</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">workers</span><span class="p">()]</span>
<span class="n">outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fetch</span><span class="o">.</span><span class="p">(</span><span class="n">futures</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-2">
<p class="admonition-title">Solution</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">batch.sh</span></code></span><a class="headerlink" href="#id9" title="Link to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --account=project_465001310</span>
<span class="c1">#SBATCH --partition=standard</span>
<span class="c1">#SBATCH --time=00:15:00</span>
<span class="c1">#SBATCH --nodes=2</span>
<span class="c1">#SBATCH --ntasks-per-node=128</span>
<span class="c1">#SBATCH --cpus-per-task=1</span>
<span class="c1">#SBATCH --mem-per-cpu=0</span>

module<span class="w"> </span>use<span class="w"> </span>/appl/local/csc/modulefiles
module<span class="w"> </span>load<span class="w"> </span>julia
julia<span class="w"> </span>--project<span class="o">=</span>.<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;using Pkg; Pkg.instantiate()&#39;</span>
julia<span class="w"> </span>--project<span class="o">=</span>.<span class="w"> </span>script.jl
</pre></div>
</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sbatch<span class="w"> </span>batch.sh
</pre></div>
</div>
</div>
</div>
<div class="admonition-run-mpi-job-on-lumi-cluster exercise important admonition" id="exercise-3">
<p class="admonition-title">Run MPI job on LUMI cluster</p>
<p>Run the following files MPI code using two nodes with two slurm tasks per node and one CPU per task.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">Project.toml</span></code></span><a class="headerlink" href="#id10" title="Link to this code"></a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[deps]</span>
<span class="n">MPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;da04e1cc-30fd-572f-bb4f-1f8673147195&quot;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">script.jl</span></code></span><a class="headerlink" href="#id11" title="Link to this code"></a></div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">MPI</span>

<span class="n">MPI</span><span class="o">.</span><span class="n">Init</span><span class="p">()</span>
<span class="n">comm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
<span class="n">rank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm_rank</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
<span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm_size</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;Hello from rank </span><span class="si">$</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span><span class="s"> out of </span><span class="si">$</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="s"> from host </span><span class="si">$</span><span class="p">(</span><span class="n">gethostname</span><span class="p">())</span><span class="s"> and process </span><span class="si">$</span><span class="p">(</span><span class="n">getpid</span><span class="p">())</span><span class="s">.&quot;</span><span class="p">)</span>
<span class="n">MPI</span><span class="o">.</span><span class="n">Barrier</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-3">
<p class="admonition-title">Solution</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">batch.sh</span></code></span><a class="headerlink" href="#id12" title="Link to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --account=project_465001310</span>
<span class="c1">#SBATCH --partition=small</span>
<span class="c1">#SBATCH --nodes=2</span>
<span class="c1">#SBATCH --ntasks-per-node=2</span>
<span class="c1">#SBATCH --cpus-per-task=1</span>
<span class="c1">#SBATCH --mem-per-cpu=1000</span>
<span class="c1">#SBATCH --time=&quot;00:15:00&quot;</span>

module<span class="w"> </span>use<span class="w"> </span>/appl/local/csc/modulefiles
module<span class="w"> </span>load<span class="w"> </span>julia
module<span class="w"> </span>load<span class="w"> </span>julia-mpi
julia<span class="w"> </span>--project<span class="o">=</span>.<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;using Pkg; Pkg.instantiate()&#39;</span>
srun<span class="w"> </span>julia<span class="w"> </span>--project<span class="o">=</span>.<span class="w"> </span>script.jl
</pre></div>
</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sbatch<span class="w"> </span>batch.sh
</pre></div>
</div>
</div>
</div>
<div class="admonition-run-gpu-job-on-lumi-cluster exercise important admonition" id="exercise-4">
<p class="admonition-title">Run GPU job on LUMI cluster</p>
<p>Run the following files GPU code using one node with one slurm tasks per node, one GPU per node and sixteen CPUs per task.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">Project.toml</span></code></span><a class="headerlink" href="#id13" title="Link to this code"></a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[deps]</span>
<span class="n">AMDGPU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;21141c5a-9bdb-4563-92ae-f87d6854732e&quot;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">script.jl</span></code></span><a class="headerlink" href="#id14" title="Link to this code"></a></div>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">AMDGPU</span>

<span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">^</span><span class="mi">9</span><span class="p">)</span>
<span class="n">A_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ROCArray</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">B_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A_d</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">A_d</span>
</pre></div>
</div>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-4">
<p class="admonition-title">Solution</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">batch.sh</span></code></span><a class="headerlink" href="#id15" title="Link to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --account=project_465001310</span>
<span class="c1">#SBATCH --partition=small-g</span>
<span class="c1">#SBATCH --time=00:15:00</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --ntasks-per-node=1</span>
<span class="c1">#SBATCH --cpus-per-task=16</span>
<span class="c1">#SBATCH --gpus-per-node=1</span>
<span class="c1">#SBATCH --mem-per-cpu=1750</span>

module<span class="w"> </span>use<span class="w"> </span>/appl/local/csc/modulefiles
module<span class="w"> </span>load<span class="w"> </span>julia
module<span class="w"> </span>load<span class="w"> </span>julia-amdgpu
julia<span class="w"> </span>--project<span class="o">=</span>.<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;using Pkg; Pkg.instantiate()&#39;</span>
julia<span class="w"> </span>--project<span class="o">=</span>.<span class="w"> </span>script.jl
</pre></div>
</div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sbatch<span class="w"> </span>batch.sh
</pre></div>
</div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../dagger/" class="btn btn-neutral float-left" title="Parallel execution with Dagger" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../MPI/" class="btn btn-neutral float-right" title="Message passing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, EuroCC National Competence Center Sweden.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>